# AGS Widgets Module

This module provides **minimal Nix integration** for AGS (Aylur's GTK Shell) with your CrystalNix theme system.

## Philosophy: Clean Separation of Concerns

After researching real-world AGS + NixOS setups, this module follows the **minimal Nix approach** used by experienced users rather than trying to manage everything declaratively.

### What Nix Handles (Infrastructure)

- âœ… **Package installation** (`ags`, `bun`, `dart-sass`)
- âœ… **Theme generation** (`~/.config/ags/styles/theme.scss` from CrystalNix)
- âœ… **systemd service** (auto-start AGS)
- âœ… **Theme bridge** (JSON export for TypeScript)

### What You Handle (Application)

- ðŸŽ¨ **Widget development** (`~/.config/ags/src/widgets/`)
- ðŸŽ¨ **Widget styling** (`~/.config/ags/styles/widgets.scss`)
- ðŸŽ¨ **TypeScript logic** (full IDE support!)
- ðŸŽ¨ **Project structure** (normal TS project)

## Research & Rationale

### Official AGS v3 Approach

The [AGS Quick Start Guide](https://aylur.github.io/ags/guide/quick-start.html) recommends:
- "It is recommended to start with a template which will setup files needed for TypeScript development environments"
- TypeScript + JSX as the primary development approach
- Normal project structure with `package.json`, `tsconfig.json`

### Real-World NixOS Users

**[fufexan's dotfiles](https://github.com/fufexan/dotfiles/blob/main/home/services/ags/default.nix)** - Popular NixOS + AGS setup:
- Nix only handles: dependencies, systemd service, package management
- AGS project: "configuration is not handled through Home Manager yet"
- Recommendation: `ln -s ~/path/to/config/ags ~/.config/ags` 
- Styling: "The theme colors can be changed in style/colors.scss" (still using SCSS!)

**[Official AGS NixOS Module](https://aylur.github.io/ags/guide/nix.html)**:
- Focuses on package management and dependencies
- Does not attempt to manage project files declaratively
- Recommends normal AGS CLI workflow for project setup

### Why This Approach Works

1. **Follows established patterns** from both official docs and real users
2. **Preserves full IDE support** for TypeScript development
3. **Keeps Nix simple** - managing infrastructure, not application code
4. **Maintains hot reload** and normal development workflow
5. **Theme integration** without complexity - simple SCSS variables

## Quick Start

1. **Add to your home.nix imports:**
   ```nix
   imports = [
     # ... your other modules
     ./modules/widgets
   ];
   ```

2. **Rebuild your system:**
   ```bash
   nrs
   ```

3. **Set up your AGS project:**
   ```bash
   cd ~/.config/ags
   
   # Initialize normal TypeScript project
   bun init
   
   # Install AGS types
   bun add -D typescript @types/node
   
   # Create basic project structure
   mkdir -p src/{widgets,utils,types} styles
   ```

4. **Start developing:**
   ```bash
   # Your theme variables are automatically available in styles/theme.scss
   # Create styles/widgets.scss and import the theme
   # Develop widgets in src/widgets/ with full IDE support
   
   bun run dev  # or ags run ./app.tsx
   ```

## File Structure

```
~/.config/ags/                    # Your AGS project (normal TS project)
â”œâ”€â”€ package.json                  # You create and manage
â”œâ”€â”€ tsconfig.json                 # You create and manage  
â”œâ”€â”€ app.tsx                       # Your main entry point
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ widgets/                  # Your widget components
â”‚   â”œâ”€â”€ utils/                    # Shared utilities
â”‚   â””â”€â”€ types/                    # TypeScript types
â”œâ”€â”€ styles/
â”‚   â”œâ”€â”€ theme.scss               # ðŸš« Generated by Nix (CrystalNix integration)
â”‚   â””â”€â”€ widgets.scss             # âœ… You write (imports theme.scss)
â””â”€â”€ theme.json                   # ðŸš« Generated by Nix (for TS import)
```

## Theme Integration

### SCSS Approach (Recommended)
```scss
// styles/widgets.scss
@import 'theme'; // Auto-generated from CrystalNix

.calendar {
  background-color: $background;
  border: 2px solid $primary;
  padding: $spacing-md;
  
  .day.today {
    background-color: $primary;
    color: $background;
  }
}
```

### TypeScript Approach (Alternative)
```typescript
// src/widgets/calendar.tsx
import theme from '../theme.json';

const calendarStyle = `
  .calendar {
    background-color: ${theme.colors.background.primary};
    border: 2px solid ${theme.colors.primary};
  }
`;
```

## Examples and Inspiration

- **[fufexan/dotfiles](https://github.com/fufexan/dotfiles/tree/main/home/services/ags)** - Real-world NixOS + AGS setup
- **[Aylur/dotfiles](https://github.com/Aylur/dotfiles)** - Creator's personal configuration  
- **[AGS Official Docs](https://aylur.github.io/ags/)** - v3 documentation with TypeScript examples
- **[AGS NixOS Usage](https://aylur.github.io/ags/guide/nix.html)** - Official NixOS integration guide

## Development Workflow

1. **Theme changes** â†’ `nrs` â†’ `theme.scss` regenerated â†’ SCSS recompiles
2. **Widget changes** â†’ Edit TypeScript/SCSS â†’ AGS hot reloads
3. **New widgets** â†’ Normal TypeScript development with full IDE support

This approach gives you the **best of both worlds**: systematic theme management through Nix + full development flexibility for your widgets.
